d bin dev etc mnt proc sys tmp
d var/run var/spool var/lock var/tmp var/log/YaST2 var/adm/mount
d var/lib/YaST2 var/lib/dhcpcd var/lib/hardware var/lib/autoinstall
d var/run/dbus var/run/hal var/run/hotplug

d etc/sysconfig
d etc/sysconfig/hardware

d var/X11R6/xkb/compiled var/X11R6/bin var/X11R6/app-defaults etc/X11 var/lib/xkb
s /usr/X11R6/lib/X11 var/X11R6/lib

d lib/modules/<kernel_ver>
d lib/modules/<kernel_mods>/initrd
s lib/modules/<kernel_mods>/initrd modules
s ../<kernel_mods> lib/modules/<kernel_ver>/updates

d mounts
d root
d download

t var/run/utmp

c 1777 0 0 tmp

glibc:
  /etc/nsswitch.conf

  linuxrc:
    if linuxrc
      if linuxrc =~ m#^[^/]#
        m /usr/sbin/<linuxrc> /linuxrc
      else
        X <linuxrc> /linuxrc
      endif
    else
      m /usr/sbin/linuxrc /linuxrc
    endif

  if initramfs
    l linuxrc init
    r linuxrc
  endif

  x etc/syslog.conf etc

  module-init-tools:
    d /sbin
    m /sbin/insmod.static /sbin/insmod

x etc/host.conf etc

if arch ne 's390' && arch ne 's390x' && arch ne 'ppc' && arch ne 'ppc64'

kbd:

  d kbd/consoletrans
if arch ne 'sparc' && arch ne 'sparc64'
  m /usr/share/kbd/consoletrans/koi2alt kbd/consoletrans
endif
  m /usr/share/kbd/consoletrans/trivial kbd/consoletrans

  d kbd/consolefonts

if 0
  g /usr/share/kbd/consolefonts/LatArCyrHeb-16.psfu.gz kbd/consolefonts/LatArCyrHeb-16.psfu
  g /usr/share/kbd/consolefonts/lat1-16.psfu.gz kbd/consolefonts/lat1-16.psfu
  g /usr/share/kbd/consolefonts/lat2-16.psfu.gz kbd/consolefonts/lat2-16.psfu
  g /usr/share/kbd/consolefonts/iso07u-16.psfu.gz kbd/consolefonts/lat7-16.psfu
  g /usr/share/kbd/consolefonts/Cyr_a8x16.psfu.gz kbd/consolefonts/Cyr_a8x16.psfu
endif

linuxrc:
  g /usr/share/linuxrc/linuxrc-16.psfu.gz kbd/consolefonts/linuxrc-16.psfu
  g /usr/share/linuxrc/linuxrc2-16.psfu.gz kbd/consolefonts/linuxrc2-16.psfu

kbd:

if arch ne 'sparc' && arch ne 'sparc64'
  d kbd/keymaps/include
  m usr/share/kbd/keymaps/include/compose.latin1 kbd/keymaps/include
endif

if arch eq 'ia32' || arch eq 'x86_64' || arch eq 'ppc' || arch eq 'ia64' || arch eq 'mips'
  if !fewkeymaps
    g /usr/share/kbd/keymaps/i386/qwerty/Pl02.map.gz kbd/keymaps/Pl02.map
    g /usr/share/kbd/keymaps/i386/qwerty/br-abnt2.map.gz kbd/keymaps/br-abnt2.map
    g /usr/share/kbd/keymaps/i386/qwertz/cz-us-qwertz.map.gz kbd/keymaps/cz-us-qwertz.map
    g /usr/share/kbd/keymaps/i386/qwerty/dk.map.gz kbd/keymaps/dk.map
    g /usr/share/kbd/keymaps/i386/qwerty/es.map.gz kbd/keymaps/es.map
    g /usr/share/kbd/keymaps/i386/qwerty/fi.map.gz kbd/keymaps/fi.map
    g /usr/share/kbd/keymaps/i386/qwerty/gr.map.gz kbd/keymaps/gr.map
    g /usr/share/kbd/keymaps/i386/qwertz/hu.map.gz kbd/keymaps/hu.map
    g /usr/share/kbd/keymaps/i386/qwerty/it.map.gz kbd/keymaps/it.map
    g /usr/share/kbd/keymaps/i386/qwerty/jp106.map.gz kbd/keymaps/jp106.map
    g /usr/share/kbd/keymaps/i386/qwerty/nl.map.gz kbd/keymaps/nl.map
    g /usr/share/kbd/keymaps/i386/qwerty/no-latin1.map.gz kbd/keymaps/no-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/pt-latin1.map.gz kbd/keymaps/pt-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/ru1.map.gz kbd/keymaps/ru1.map
    g /usr/share/kbd/keymaps/i386/qwerty/sk-qwerty.map.gz kbd/keymaps/sk-qwerty.map
    g /usr/share/kbd/keymaps/i386/qwerty/sv-latin1.map.gz kbd/keymaps/sv-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/uk.map.gz kbd/keymaps/uk.map
    g /usr/share/kbd/keymaps/i386/azerty/fr-latin1.map.gz kbd/keymaps/fr-latin1.map

    m /usr/share/kbd/keymaps/i386/include/linux-with-modeshift-altgr.inc kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/linux-keys-extd.inc kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/azerty-layout.inc kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/linux-with-two-alt-keys.inc kbd/keymaps/include
  endif

  g /usr/share/kbd/keymaps/i386/qwerty/us.map.gz kbd/keymaps/us.map
  g /usr/share/kbd/keymaps/i386/qwertz/de-latin1-nodeadkeys.map.gz kbd/keymaps/de-lat1-nd.map
  g /usr/share/kbd/keymaps/i386/qwertz/de-latin1.map.gz kbd/keymaps/de-latin1.map

  m /usr/share/kbd/keymaps/i386/include/linux-keys-bare.inc kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/linux-with-alt-and-altgr.inc kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/qwerty-layout.inc kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/qwertz-layout.inc kbd/keymaps/include
  g /usr/share/kbd/keymaps/i386/include/euro1.map.gz kbd/keymaps/include/euro1.map
  g /usr/share/kbd/keymaps/i386/include/euro2.map.gz kbd/keymaps/include/euro2.map
endif

if arch eq 'ppc'
  m /usr/share/kbd/keymaps/mac/include/mac-{azerty-layout,qwerty-layout,linux-keys-bare}.inc kbd/keymaps/include
  g /usr/share/kbd/keymaps/mac/include/mac-euro.map.gz kbd/keymaps/include/mac-euro.map
  g /usr/share/kbd/keymaps/mac/all/mac-be.map.gz kbd/keymaps/mac-be.map
  g /usr/share/kbd/keymaps/mac/all/mac-de-latin1-nodeadkeys.map.gz kbd/keymaps/mac-de-latin1-nodeadkeys.map
  g /usr/share/kbd/keymaps/mac/all/mac-de-latin1.map.gz kbd/keymaps/mac-de-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-de_CH.map.gz kbd/keymaps/mac-de_CH.map
  g /usr/share/kbd/keymaps/mac/all/mac-dk-latin1.map.gz kbd/keymaps/mac-dk-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-es.map.gz kbd/keymaps/mac-es.map
  g /usr/share/kbd/keymaps/mac/all/mac-fi-latin1.map.gz kbd/keymaps/mac-fi-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-fr.map.gz kbd/keymaps/mac-fr.map
  g /usr/share/kbd/keymaps/mac/all/mac-it.map.gz kbd/keymaps/mac-it.map
  g /usr/share/kbd/keymaps/mac/all/mac-se.map.gz kbd/keymaps/mac-se.map
  g /usr/share/kbd/keymaps/mac/all/mac-uk.map.gz kbd/keymaps/mac-uk.map
  g /usr/share/kbd/keymaps/mac/all/mac-us.map.gz kbd/keymaps/mac-us.map
endif

if arch eq 'sparc' || arch eq 'sparc64'
  d kbd/keymaps
  g /usr/share/kbd/keymaps/sun/sunkeymap.map.gz kbd/keymaps/sunkeymap.map
  g /usr/share/kbd/keymaps/sun/sunt4-es.map.gz kbd/keymaps/sunt4-es.map
  g /usr/share/kbd/keymaps/sun/sunt4-fi-latin1.map.gz kbd/keymaps/sunt4-fi-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt4-no-latin1.map.gz kbd/keymaps/sunt4-no-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-de-latin1.map.gz kbd/keymaps/sunt5-de-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-es.map.gz kbd/keymaps/sunt5-es.map
  g /usr/share/kbd/keymaps/sun/sunt5-fi-latin1.map.gz kbd/keymaps/sunt5-fi-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-fr-latin1.map.gz kbd/keymaps/sunt5-fr-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-ru.map.gz kbd/keymaps/sunt5-ru.map
  g /usr/share/kbd/keymaps/sun/sunt5-uk.map.gz kbd/keymaps/sunt5-uk.map
endif

endif # not on s390/ppc

if arch eq 's390' || arch eq 's390x' || with_smb

  d etc/samba
  e echo "; just to make smbmount happy" >etc/samba/smb.conf

    d bin lib

    samba-client:
      m /usr/bin/smbmount /bin/smbmount

    glibc:
      /lib*/libpthread{.,-}*

    pam:
      /lib*/libpam.so.*

    cups-libs:
      m /usr/lib*/libcups.so.* /lib

    openssl:
      m /usr/lib*/libcrypto.so.* /lib
      m /usr/lib*/libssl.so.* /lib

    krb5:
      m /usr/lib*/libkrb5.so.* /lib
      m /usr/lib*/libkrb5support.so.* /lib
      m /usr/lib*/libgssapi_krb5.so.* /lib
      m /usr/lib*/libk5crypto.so.* /lib
      
    openldap2-client:
      m /usr/lib*/liblber-*.so.* /lib
      m /usr/lib*/libldap-*.so.* /lib
    
    e2fsprogs:
      m /lib*/libcom_err.so.* /lib

    libcom_err:
      m /lib*/libcom_err.so.* /lib
      m /lib*/libss.so.* /lib

    db:
      m /usr/lib*/libdb-4.2.so /lib
    
    cyrus-sasl:
      m /usr/lib*/libsasl2.so.* /lib

endif

if with_gdb

  kbd:
   /bin/kbd_mode

  iputils:
    /bin/ping

  net-tools:
    m /sbin/{ifconfig,route} /bin

  strace:
    m /usr/bin/strace /bin

  gdb:
    m /usr/bin/gdb /bin/gdb

  readline:
    /lib*/libreadline.so*
    /lib*/libhistory.so*

  ncurses:
    /lib*/libncurses.so.5*

  procps:
    /bin/ps

  psmisc:
    /bin/fuser
    m /usr/bin/killall /bin
    m /usr/bin/pstree /bin

  coreutils:
    m /usr/bin/head /bin
    m /usr/bin/tail /bin

  bash:
    /bin/bash
    /bin/sh

  util-linux:
    /bin/mount
    /bin/umount

  libselinux:
    /lib*/libselinux.so*

  glibc:
    /lib*/librt{.,-}*
    /lib*/libpthread{.,-}*

  if with_gdb == 2

    linuxrc:
      m /usr/sbin/linuxrc /bin/linuxrc

      e echo -e "#! /bin/sh\nexport PATH=/bin:/sbin:/lbin\nPS1=\\\\\\w\>\n/bin/bash\n" >linuxrc

  endif

  if with_gdb == 3

    linuxrc:
      m /usr/sbin/linuxrc /bin/linuxrc

      e echo run >zap
      e echo -e "#! /bin/sh\ngdb --command /zap /bin/linuxrc" >linuxrc

  endif


  d /lbin
  s /init /lbin/cp
  s /init /lbin/mv
  s /init /lbin/modprobe
  s /init /lbin/rmmod
  s /init /lbin/lsmod
  s /init /lbin/mount
  s /init /lbin/umount
  s /init /lbin/cat
  s /init /lbin/hex
  s /init /lbin/lsof
  s /init /lbin/rm
  s /init /lbin/ln
  s /init /lbin/ls
  s /init /lbin/mkdevs
  s /init /lbin/mkdir
  s /init /lbin/chroot
  s /init /lbin/kill
  s /init /lbin/swapon
  s /init /lbin/swapoff
  s /init /lbin/free
  s /init /lbin/fstype
  s /init /lbin/lndir
  s /init /lbin/dhcpcd
  s /init /lbin/portmap
  s /init /lbin/lsh
  s /init /lbin/loadkeys
  s /init /lbin/dumpkeys
  s /init /lbin/setfont

endif


glibc:
  /lib*/ld*
  /lib*/libc{.,-}*
  /lib*/{libcrypt,libdl,libnsl,libresolv}{.,-}*
  /lib*/{libnss_compat,libnss_dns,libnss_files,libnss_hesiod}{.,-}*
  /lib*/libm{.,-}*
  /lib*/libthread_db{.,-}*

cifs-mount:
  /sbin/mount.cifs

sysfsutils:
  /lib*/libsysfs.so.*

dbus-1:
  /usr/lib*/libdbus-1.so.*

hal:
  /usr/lib*/libhal.so.*

hwinfo-devel:
  /usr/lib*/libhd_tiny.so.*

bootsplash:
  /lib/bootsplash/control
  /sbin/splash

zlib:
  /lib*/libz.so.1*

bootsplash-theme-<splash_theme>:
  /etc/bootsplash/themes/<splash_theme>/animations

if mkdevs
  e cp -a /initrddevs.tiny/dev .
  e cp -a /devz .
else
  e cp -a /initrddevs/dev .
endif

# see etc/module.list
e echo "KernelPCMCIA:	1" >>linuxrc.config

e echo "UseUSBSCSI:	1" >>linuxrc.config
e echo "Product:	<product_name>" >>linuxrc.config
e echo "UpdateDir:	<update_dir>" >>linuxrc.config

if load_image
  if arch eq 'x86_64'
    e echo "MemLoadImage:	307200" >>linuxrc.config
  else
    e echo "MemLoadImage:	<load_image>" >>linuxrc.config
  endif
endif

if min_memory
  e echo "MinMemory:	<min_memory>" >>linuxrc.config
endif

if lang
  e echo "Language:	<lang>" >>linuxrc.config
endif

if liveeval
  e echo "UseIDESCSI:	1" >>linuxrc.config
  e echo "LiveConfig:	suselive.900" >>linuxrc.config
endif

if arch eq 'ppc' || arch eq 's390' || arch eq 's390x'
  e echo "Linemode:	1" >>linuxrc.config
endif

# min. free kB for X11 YaST (below ncurses will be used)
# 92000 free ~ 110MB total mem
e echo "MemYaST:	92000" >>linuxrc.config

# min. free kB for ncurses YaST (below swap will be activated)
e echo "MemYaSTText:	64000" >>linuxrc.config

if instsys_complain
  e echo "InstsysComplain:	<instsys_complain>" >>linuxrc.config
endif

if instsys_build_id
  e echo "InitrdID:	<instsys_build_id>" >>linuxrc.config
endif

if arch eq 'x86_64'
e echo "InstallDir:	/boot/inst-sys64" >>linuxrc.config
e echo "RescueImage:	/boot/rescue64" >>linuxrc.config
e echo "RootImage:	/boot/root64" >>linuxrc.config
endif

if arch eq 'ppc'
e echo "InstallDir:	/boot/inst-sys.ppc" >>linuxrc.config
e echo "RescueImage:	/boot/rescue.ppc" >>linuxrc.config
e echo "RootImage:	/boot/root.ppc" >>linuxrc.config
endif

# turn off automatic module disks requests in linuxrc (there are no module
# disks)

e echo "ModuleDisks:	0" >>linuxrc.config

