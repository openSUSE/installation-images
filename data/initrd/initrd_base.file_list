d bin dev etc mnt proc sys tmp
d var/run var/spool var/lock var/tmp var/log/YaST2 var/adm/mount
d var/lib/YaST2 var/lib/dhcpcd var/lib/hardware/unique-keys var/lib/autoinstall
d var/run/dbus var/run/hal var/run/hotplug var/cache/fontconfig
d var/lib/sshd var/lib/empty

d etc/sysconfig
d etc/sysconfig/hardware
d etc/YaST2

d var/lib/xkb/compiled etc/X11

d lib/modules/<kernel_ver>
d lib/modules/<kernel_ver>/initrd
s lib/modules/<kernel_ver>/initrd modules

d mounts
d root
d download

t var/run/utmp

c 1777 0 0 tmp

e cp -a /dev/{null,zero,console,ram0,tty[1349]} dev
C 4 4 /dev/tty4
# historical static device nodes
x devz /devz

aaa_base: prein
  e prein
  # keep only passwd & group
  r boot
  r etc/init.d
  r etc/mtab
  r var/adm/fillup-templates

dbus-1: prein
  e save_cfg etc/passwd etc/shadow etc/group
  e prein
  e restore_cfg etc/passwd etc/shadow etc/group

hal: prein
  e save_cfg etc/passwd etc/shadow etc/group
  e prein
  e restore_cfg etc/passwd etc/shadow etc/group

openssh: prein
  e save_cfg etc/passwd etc/shadow etc/group
  e prein
  e restore_cfg etc/passwd etc/shadow etc/group
  d etc/ssh

glibc:
  /etc/nsswitch.conf

  linuxrc:
    if linuxrc
      if linuxrc =~ m#^[^/]#
        m /usr/sbin/<linuxrc> /linuxrc
      else
        X <linuxrc> /linuxrc
      endif
    else
      m /usr/sbin/linuxrc /linuxrc
    endif

  if initramfs
    l linuxrc init
    r linuxrc
  endif

  x etc/syslog.conf etc

module-init-tools:
  /etc/modprobe.conf
  /etc/modprobe.conf.local
  d /etc/modprobe.d
  /sbin/insmod
  /sbin/modprobe

x etc/host.conf etc

if arch ne 's390' && arch ne 's390x'

kbd:
  /bin/dumpkeys
  /bin/loadkeys
  /bin/setfont

  d usr/share/kbd/consoletrans
if arch ne 'sparc' && arch ne 'sparc64'
  m /usr/share/kbd/consoletrans/koi2alt usr/share/kbd/consoletrans
endif
  m /usr/share/kbd/consoletrans/trivial usr/share/kbd/consoletrans

  d usr/share/kbd/consolefonts

if 0
  g /usr/share/kbd/consolefonts/LatArCyrHeb-16.psfu.gz usr/share/kbd/consolefonts/LatArCyrHeb-16.psfu
  g /usr/share/kbd/consolefonts/lat1-16.psfu.gz usr/share/kbd/consolefonts/lat1-16.psfu
  g /usr/share/kbd/consolefonts/lat2-16.psfu.gz usr/share/kbd/consolefonts/lat2-16.psfu
  g /usr/share/kbd/consolefonts/iso07u-16.psfu.gz usr/share/kbd/consolefonts/lat7-16.psfu
  g /usr/share/kbd/consolefonts/Cyr_a8x16.psfu.gz usr/share/kbd/consolefonts/Cyr_a8x16.psfu
endif

linuxrc:
  g /usr/share/linuxrc/linuxrc-16.psfu.gz usr/share/kbd/consolefonts/linuxrc-16.psfu
  g /usr/share/linuxrc/linuxrc2-16.psfu.gz usr/share/kbd/consolefonts/linuxrc2-16.psfu

kbd:

if arch ne 'sparc' && arch ne 'sparc64'
  d usr/share/kbd/keymaps/include
  m usr/share/kbd/keymaps/include/compose.latin1 usr/share/kbd/keymaps/include
endif

if arch eq 'ia32' || arch eq 'x86_64' || arch eq 'ppc' || arch eq 'ia64' || arch eq 'mips'
  if !fewkeymaps
    g /usr/share/kbd/keymaps/i386/qwerty/Pl02.map.gz usr/share/kbd/keymaps/Pl02.map
    g /usr/share/kbd/keymaps/i386/qwerty/br-abnt2.map.gz usr/share/kbd/keymaps/br-abnt2.map
    g /usr/share/kbd/keymaps/i386/qwertz/cz-us-qwertz.map.gz usr/share/kbd/keymaps/cz-us-qwertz.map
    g /usr/share/kbd/keymaps/i386/qwerty/dk.map.gz usr/share/kbd/keymaps/dk.map
    g /usr/share/kbd/keymaps/i386/qwerty/es.map.gz usr/share/kbd/keymaps/es.map
    g /usr/share/kbd/keymaps/i386/qwerty/gr.map.gz usr/share/kbd/keymaps/gr.map
    g /usr/share/kbd/keymaps/i386/qwertz/hu.map.gz usr/share/kbd/keymaps/hu.map
    g /usr/share/kbd/keymaps/i386/qwerty/it.map.gz usr/share/kbd/keymaps/it.map
    g /usr/share/kbd/keymaps/i386/qwerty/jp106.map.gz usr/share/kbd/keymaps/jp106.map
    g /usr/share/kbd/keymaps/i386/qwerty/nl.map.gz usr/share/kbd/keymaps/nl.map
    g /usr/share/kbd/keymaps/i386/qwerty/no-latin1.map.gz usr/share/kbd/keymaps/no-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/pt-latin1.map.gz usr/share/kbd/keymaps/pt-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/ru1.map.gz usr/share/kbd/keymaps/ru1.map
    g /usr/share/kbd/keymaps/i386/qwerty/sk-qwerty.map.gz usr/share/kbd/keymaps/sk-qwerty.map
    g /usr/share/kbd/keymaps/i386/qwertz/slovene.map.gz usr/share/kbd/keymaps/slovene.map
    g /usr/share/kbd/keymaps/i386/qwerty/sv-latin1.map.gz usr/share/kbd/keymaps/sv-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/fi-latin1.map.gz usr/share/kbd/keymaps/fi-latin1.map
    g /usr/share/kbd/keymaps/i386/qwerty/uk.map.gz usr/share/kbd/keymaps/uk.map
    g /usr/share/kbd/keymaps/i386/azerty/fr-latin1.map.gz usr/share/kbd/keymaps/fr-latin1.map
    g /usr/share/kbd/keymaps/i386/azerty/be-latin1.map.gz usr/share/kbd/keymaps/be-latin1.map

    m /usr/share/kbd/keymaps/i386/include/linux-with-modeshift-altgr.inc usr/share/kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/linux-keys-extd.inc usr/share/kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/azerty-layout.inc usr/share/kbd/keymaps/include
    m /usr/share/kbd/keymaps/i386/include/linux-with-two-alt-keys.inc usr/share/kbd/keymaps/include
  endif

  g /usr/share/kbd/keymaps/i386/qwerty/us.map.gz usr/share/kbd/keymaps/us.map
  g /usr/share/kbd/keymaps/i386/qwertz/de-latin1-nodeadkeys.map.gz usr/share/kbd/keymaps/de-lat1-nd.map
  g /usr/share/kbd/keymaps/i386/qwertz/de-latin1.map.gz usr/share/kbd/keymaps/de-latin1.map

  m /usr/share/kbd/keymaps/i386/include/linux-keys-bare.inc usr/share/kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/linux-with-alt-and-altgr.inc usr/share/kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/qwerty-layout.inc usr/share/kbd/keymaps/include
  m /usr/share/kbd/keymaps/i386/include/qwertz-layout.inc usr/share/kbd/keymaps/include
  g /usr/share/kbd/keymaps/i386/include/euro1.map.gz usr/share/kbd/keymaps/include/euro1.map
  g /usr/share/kbd/keymaps/i386/include/euro2.map.gz usr/share/kbd/keymaps/include/euro2.map
endif

if arch eq 'ppc'
  m /usr/share/kbd/keymaps/mac/include/mac-{azerty-layout,qwert{y,z}-layout,linux-keys-bare}.inc usr/share/kbd/keymaps/include
  g /usr/share/kbd/keymaps/mac/include/mac-euro.map.gz usr/share/kbd/keymaps/include/mac-euro.map
  g /usr/share/kbd/keymaps/mac/include/mac-euro2.map.gz usr/share/kbd/keymaps/include/mac-euro2.map
  g /usr/share/kbd/keymaps/mac/all/mac-be.map.gz usr/share/kbd/keymaps/mac-be.map
  g /usr/share/kbd/keymaps/mac/all/mac-de-latin1-nodeadkeys.map.gz usr/share/kbd/keymaps/mac-de-latin1-nodeadkeys.map
  g /usr/share/kbd/keymaps/mac/all/mac-de-latin1.map.gz usr/share/kbd/keymaps/mac-de-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-de_CH.map.gz usr/share/kbd/keymaps/mac-de_CH.map
  g /usr/share/kbd/keymaps/mac/all/mac-dk-latin1.map.gz usr/share/kbd/keymaps/mac-dk-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-es.map.gz usr/share/kbd/keymaps/mac-es.map
  g /usr/share/kbd/keymaps/mac/all/mac-fi-latin1.map.gz usr/share/kbd/keymaps/mac-fi-latin1.map
  g /usr/share/kbd/keymaps/mac/all/mac-fr.map.gz usr/share/kbd/keymaps/mac-fr.map
  g /usr/share/kbd/keymaps/mac/all/mac-it.map.gz usr/share/kbd/keymaps/mac-it.map
  g /usr/share/kbd/keymaps/mac/all/mac-se.map.gz usr/share/kbd/keymaps/mac-se.map
  g /usr/share/kbd/keymaps/mac/all/mac-uk.map.gz usr/share/kbd/keymaps/mac-uk.map
  g /usr/share/kbd/keymaps/mac/all/mac-us.map.gz usr/share/kbd/keymaps/mac-us.map
endif

if arch eq 'sparc' || arch eq 'sparc64'
  d usr/share/kbd/keymaps
  g /usr/share/kbd/keymaps/sun/sunkeymap.map.gz usr/share/kbd/keymaps/sunkeymap.map
  g /usr/share/kbd/keymaps/sun/sunt4-es.map.gz usr/share/kbd/keymaps/sunt4-es.map
  g /usr/share/kbd/keymaps/sun/sunt4-fi-latin1.map.gz usr/share/kbd/keymaps/sunt4-fi-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt4-no-latin1.map.gz usr/share/kbd/keymaps/sunt4-no-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-de-latin1.map.gz usr/share/kbd/keymaps/sunt5-de-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-es.map.gz usr/share/kbd/keymaps/sunt5-es.map
  g /usr/share/kbd/keymaps/sun/sunt5-fi-latin1.map.gz usr/share/kbd/keymaps/sunt5-fi-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-fr-latin1.map.gz usr/share/kbd/keymaps/sunt5-fr-latin1.map
  g /usr/share/kbd/keymaps/sun/sunt5-ru.map.gz usr/share/kbd/keymaps/sunt5-ru.map
  g /usr/share/kbd/keymaps/sun/sunt5-uk.map.gz usr/share/kbd/keymaps/sunt5-uk.map
endif

endif # not on s390

if arch eq 's390' || arch eq 's390x' || with_smb

    d bin lib

    glibc:
      /lib*/libpthread{.,-}*

    pam:
      /lib*/libpam.so.*

    audit-libs:
      /lib*/libaudit.so.*

    cups-libs:
      m /usr/lib*/libcups.so.* /lib

    libopenssl0_9_8:
      m /usr/lib*/libcrypto.so.* /lib
      m /usr/lib*/libssl.so.* /lib

    krb5:
      m /usr/lib*/libkrb5.so.* /lib
      m /usr/lib*/libkrb5support.so.* /lib
      m /usr/lib*/libgssapi_krb5.so.* /lib
      m /usr/lib*/libk5crypto.so.* /lib

    keyutils-libs:
      /lib*/libkeyutils{.,-}*

    e2fsprogs:
      m /lib*/lib*.so.* /lib

    libcom_err2:
      m /lib*/libcom_err.so.* /lib
      m /lib*/libss.so.* /lib

    db:
      m /usr/lib*/libdb-4*.so /lib
    
endif

if arch eq 's390' || arch eq 's390x'
    s390-tools:
      /sbin/zfcp_*_configure
      /sbin/dasdinfo
      /etc/udev
endif

sed:
  /bin/sed

if with_gdb

  valgrind:
    /

  kbd:
    /bin/kbd_mode

  strace:
    /usr/bin/strace

  gdb:
    /usr/bin/gdb

  libexpat1:
    /lib*/libexpat.so.*

  procps:
    /bin/ps

  psmisc:
    /bin/fuser
    /usr/bin/killall
    /usr/bin/pstree

  coreutils:
    /usr/bin/head
    /usr/bin/tail

  linuxrc-debuginfo:
    /

  if with_gdb == 2

    linuxrc:
      e mv init sbin

      e echo -e "#! /bin/sh\nexport PATH=/bin:/usr/bin:/sbin:/usr/sbin:/lbin\nPS1=\\\\\\w\>\n/bin/bash\n" >init
      c 755 0 0 init
  endif

  if with_gdb == 3

    linuxrc:
      e mv init sbin

      e echo run >zap
      e echo -e "#! /bin/sh\ngdb --command /zap /sbin/init" >init
      c 755 0 0 init

  endif


  d /lbin
  s /init /lbin/cp
  s /init /lbin/mv
  s /init /lbin/modprobe
  s /init /lbin/rmmod
  s /init /lbin/lsmod
  s /init /lbin/mount
  s /init /lbin/umount
  s /init /lbin/cat
  s /init /lbin/hex
  s /init /lbin/lsof
  s /init /lbin/rm
  s /init /lbin/ln
  s /init /lbin/ls
  s /init /lbin/mkdevs
  s /init /lbin/mkdir
  s /init /lbin/chroot
  s /init /lbin/kill
  s /init /lbin/swapon
  s /init /lbin/swapoff
  s /init /lbin/free
  s /init /lbin/fstype
  s /init /lbin/lndir

endif


glibc:
  /lib*/ld*
  /lib*/libc{.,-}*
  /lib*/{libcrypt,libdl,libnsl,libresolv}{.,-}*
  /lib*/{libnss_compat,libnss_dns,libnss_files,libnss_hesiod}{.,-}*
  /lib*/libm{.,-}*
  /lib*/libthread_db{.,-}*
  /lib*/libutil{.,-}*
  /lib*/librt{.,-}*
  /lib*/libpthread{.,-}*

cifs-mount:
  /sbin/mount.cifs

sysfsutils:
  /lib*/libsysfs.so.*

dbus-1:
  /lib*/libdbus-1.so.*

hal:
  /usr/lib*/libhal.so.*
  /var/cache/hald

libusb:
  /usr/lib*/libusb-0.1.so.*

libuuid1:
  /lib*/libuuid.so.*

libblkid1:
  /lib*/libblkid.so.*

hwinfo:
  /usr/lib*/libhd.so.*
  /usr/sbin/hwinfo

if arch eq 'ia64' || arch eq 'ia32' || arch eq 'x86_64'
pmtools:
  /usr/sbin/dmidecode
  /usr/sbin/acpidump
endif

if arch eq 'ia32' || arch eq 'x86_64'
    bootsplash:
      /sbin/splash

      d /etc/bootsplash/themes/<splash_theme>
      e cp -a /<theme>/animations etc/bootsplash/themes/<splash_theme>
      e cp -a /<theme>/images etc/bootsplash/themes/<splash_theme>

  # wlan
  ipw-firmware:
    /lib/firmware

  iwl3945-ucode:
    /lib/firmware/iwlwifi-*

  iwl4965-ucode:
    /lib/firmware/iwlwifi-*

  atmel-firmware:
    /lib/firmware

  wpa_supplicant:
    /usr/sbin

  wireless-tools:
    /usr/sbin
    /usr/lib*/libiw.so.*
    /etc
    r /usr/sbin/switch_prism_driver
    r /usr/sbin/install_acx100_firmware
    r /usr/sbin/install_intersil_firmware

endif
# i386/x86_64

libopenssl0_9_8:
  /usr/lib*/libcrypto.so.*
  /usr/lib*/libssl.so.*

curl:
  /usr/bin/curl

libcurl4:
  /usr/lib*/libcurl.so.*

libidn:
  /usr/lib*/libidn.so.*

openldap2-client:
  /usr/lib*/liblber-*.so.*
  /usr/lib*/libldap-*.so.*

cyrus-sasl:
  /usr/lib*/libsasl2.so.*

zlib:
  /lib*/libz.so.1*

coreutils:
  /bin/rm
  /bin/sleep
  /bin/cat
  /bin/mkdir
  /bin/rmdir
  /bin/ln

pcmciautils:
  /etc/udev/rules.d/60-pcmcia.rules
  /etc/pcmcia/config.opts
  /sbin/pcmcia-socket-startup

bash:
  /bin/{sh,bash}
  s bash /bin/lsh

libreadline5:
  /lib*/libreadline.so*
  /lib*/libhistory.so*

ncurses:
  /lib*/libncurses.so.5*

portmap:
  /sbin/portmap

tcpd:
  /lib*/libwrap.so.*

dhcpcd:
  /sbin/dhcpcd

iputils:
  /bin/ping

net-tools:
  /sbin/ifconfig
  /sbin/route

iproute2:
  /sbin/ip

ethtool:
  /sbin/ethtool

qlogic-firmware:
  /lib/firmware

adaptec-firmware:
  /lib/firmware

open-iscsi:
  # must be writable
  /etc/iscsi/iscsid.conf
  c 644 0 0 /etc/iscsi/iscsid.conf
  # /var/lib/open-iscsi

cpio:
  /bin/cpio

util-linux:
  /sbin/mkswap
  /bin/more
  /bin/mount
  /bin/umount
  /usr/sbin/setctsid

nfs-client:
  /var/lib/nfs

gpg2:
  /usr/bin/gpg{,2}
d root/.gnupg

libbz2-1:
  /lib*/libbz2.so*

libgcrypt11:
  /lib*/libgcrypt.so*

libgpg-error0:
 /lib*/libgpg-error.so*

suse-build-key:
  m /usr/lib/rpm/gnupg/suse-build-key.gpg /installkey.gpg

# add udev
libvolume_id:
  /lib*/libvolume_id.so*

udev:
  /etc
  /lib/udev
  /sbin
  /usr/bin
  /usr/sbin
x etc/myudevstart /bin
r /etc/init.d
  # add some md devices statically
  b 9  0 /lib/udev/devices/md0
  b 9  1 /lib/udev/devices/md1
  b 9  2 /lib/udev/devices/md2
  b 9  3 /lib/udev/devices/md3
  b 9  4 /lib/udev/devices/md4
  b 9  5 /lib/udev/devices/md5
  b 9  6 /lib/udev/devices/md6
  b 9  7 /lib/udev/devices/md7
  b 9  8 /lib/udev/devices/md8
  b 9  9 /lib/udev/devices/md9
  b 9 10 /lib/udev/devices/md10
  b 9 11 /lib/udev/devices/md11
  b 9 12 /lib/udev/devices/md12
  b 9 13 /lib/udev/devices/md13
  b 9 14 /lib/udev/devices/md14
  b 9 15 /lib/udev/devices/md15

# our own rules file which loads only pnp subsystem mods
r /etc/udev/rules.d/*-drivers.rules
x etc/80-drivers.rules /etc/udev/rules.d

sysconfig:
  # for ipw3945d
  /etc/udev/rules.d/*-network.rules 
  e perl -ni -e "print if /^SUBSYSTEM.*ipw3945/" etc/udev/rules.d/*-network.rules

ntfs-3g:
  /sbin
  /bin
  /lib*/libntfs-3g.so.*

if 0
libfuse2:
  /lib*/libfuse.so.*
endif

kexec-tools:
  /sbin/kexec

sysvinit:
  /sbin/showconsole
  c 755 0 0 /sbin/showconsole

PolicyKit:
  /var/lib
  /var/run

# add hal & dbus
if 0

  glibc:
    /lib*/libpthread{.,-}*

  libxml2:
    /usr/lib*/libxml2.so.*

  libexpat1:
    /lib*/libexpat.so.*

  glib2:
    /usr/lib*/libglib-2.0.so.*
    /usr/lib*/libgobject-2.0.so.*

  dbus-1-glib:
    /lib*/libdbus-glib-1.so.*
    /bin/dbus-monitor

  e cp /etc/{passwd,shadow,group} etc
  dbus-1: prein
    /etc
    /usr/bin/dbus-daemon

    e save_cfg etc/passwd etc/shadow etc/group
    e prein
    e restore_cfg etc/passwd etc/shadow etc/group

  hal: prein
    /etc
    /usr/bin/lshal
    /usr/sbin/hald*
    
    e save_cfg etc/passwd etc/shadow etc/group
    e prein
    e restore_cfg etc/passwd etc/shadow etc/group


  # + bash for testing

endif


:

x etc/prepare_rescue bin

# get busybox
d usr/local/bin
e cp -a /tmp/bb/{,usr/}{bin,sbin}/* usr/local/bin
e rm usr/local/bin/init

e ldconfig -r .

# see etc/module.list
e echo "KernelPCMCIA:	1" >>linuxrc.config

e echo "UseUSBSCSI:	1" >>linuxrc.config
e echo "Product:	<product_name>" >>linuxrc.config
e echo "UpdateDir:	<update_dir>" >>linuxrc.config

if load_image
  if arch eq 'ia32'
    e echo "MemLoadImage:	327680" >>linuxrc.config
  else
    e echo "MemLoadImage:	<load_image>" >>linuxrc.config
  endif
endif

if min_memory
  e echo "MinMemory:	<min_memory>" >>linuxrc.config
endif

if lang
  e echo "Language:	<lang>" >>linuxrc.config
endif

if liveeval
  e echo "UseIDESCSI:	1" >>linuxrc.config
  e echo "LiveConfig:	suselive.900" >>linuxrc.config
endif

if arch eq 'ppc' || arch eq 's390' || arch eq 's390x'
  e echo "Linemode:	1" >>linuxrc.config
endif

# min. free kB for YaST (below swap will be activated)
if arch eq 'ia32'
  # just so that 256MB won't get swap
  e echo "MemYaST:	230000" >>linuxrc.config
else
  e echo "MemYaST:	123456" >>linuxrc.config
endif

if instsys_complain
  e echo "InstsysComplain:	<instsys_complain>" >>linuxrc.config
endif

if instsys_build_id
  e echo "InitrdID:	<instsys_build_id>" >>linuxrc.config
endif

